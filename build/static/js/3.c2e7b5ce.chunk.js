(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{30:function(t,e,a){"use strict";function n(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}a.r(e);var r=a(31),s=a(32),c=a(34),i=a(33),o=a(36),l=a(35),u=a(0),m=a.n(u),p=a(11),d=a(3),h=function(t){function e(){return Object(r.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return m.a.createElement(m.a.Fragment,null,m.a.createElement("nav",{className:"navbar navbar-expand bg-light sticky-top mb-2 navbar-light"},m.a.createElement("div",{className:"navbar-brand"},this.props.brand),m.a.createElement("ul",{className:"navbar-nav mr-auto"},m.a.createElement("li",{className:"nav-item"},m.a.createElement(p.c,{to:"/register",className:"nav-link"},"Register")),m.a.createElement("li",{className:"nav-item"},m.a.createElement(p.c,{to:"/products",className:"nav-link"},"Products")),m.a.createElement("li",{className:"nav-item"},m.a.createElement(p.c,{to:"/settings",className:"nav-link"},"Settings"))),m.a.createElement("div",{className:"navbar-nav f-flex flex-column"},m.a.createElement("span",null,"Running as ",m.a.createElement("span",{className:"font-weight-bold"},this.props.role?"Master":"Slave")),m.a.createElement("span",{className:"text-secondary font-weight-light"},"Status: ",this.props.connected?m.a.createElement("span",{className:"text-success"},"Connected"):m.a.createElement("span",{className:"text-danger"},"Disconnected")))))}}]),e}(m.a.Component),f=(a(42),{maxWidth:"100px",maxHeight:"100px",width:"auto",height:"auto",objectFit:"contain"}),b=function(t){function e(){return Object(r.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return m.a.createElement(m.a.Fragment,null,m.a.createElement("img",{alt:"",src:this.props.source,style:f}))}}]),e}(m.a.Component),g=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(c.a)(this,Object(i.a)(e).call(this,t))).plusOne=a.plusOne.bind(Object(o.a)(a)),a.minusOne=a.minusOne.bind(Object(o.a)(a)),a.setInput=a.props.setInput,a}return Object(l.a)(e,t),Object(s.a)(e,[{key:"minusOne",value:function(){this.props.remove(this.props.product.id,1)}},{key:"plusOne",value:function(){this.props.add(this.props.product.id,1)}},{key:"render",value:function(){return m.a.createElement(m.a.Fragment,null,!0===this.props.product.enabled?m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"col-auto col-sm-6 col-md-4 col-lg-3 mb-2"},m.a.createElement("div",{className:"bg-light rounded p-3"},m.a.createElement("div",{className:"row mb-4 d-flex justify-content-between p-3"},m.a.createElement("b",null,this.props.product.name),this.props.sign," ",this.props.product.currentPrice,m.a.createElement("small",{className:this.props.product.stock<30?"text-danger":"text-muted"},"(stock: ",this.props.product.currentStock,")")),m.a.createElement("div",{className:"row mb-4"},m.a.createElement("div",{className:"col-12 d-flex justify-content-center"},this.props.product.display?m.a.createElement(b,{className:"col-12",source:"".concat("","/image/").concat(this.props.product.display)}):null)),m.a.createElement("div",{className:"row mb-2"},m.a.createElement("div",{className:"col-6"},m.a.createElement("p",{className:"buttons minus rounded",onClick:this.minusOne},"-")),m.a.createElement("div",{className:"col-6"},m.a.createElement("p",{className:"buttons plus rounded",onClick:this.plusOne},"+")))))):null)}}]),e}(m.a.Component),v=function(t){function e(){return Object(r.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){var t=this,e=this.props.cart.reduce(function(t,e){return t+e.quantity*e.currentPrice},0).toFixed(2);return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"col-12 col-lg-2 row ml-auto mr-auto mb-2 align-items-start"},m.a.createElement("ul",{style:{width:"100%"},className:"list-group list-group-flush col-12"},this.props.cart.map(function(e,a){return e.quantity>0?m.a.createElement("li",{key:a,className:"list-group-item d-flex justify-content-between align-items-start"},e.readableName," ",m.a.createElement("small",{className:"text-muted ml-2"},"(",t.props.sign," ",e.currentPrice,")"),m.a.createElement("span",{className:"badge badge-primary badge-pill ml-auto"},e.quantity)):null})),m.a.createElement("p",{className:"mt-3 col-12 h3 d-flex justify-content-around text-primary"},e>0?m.a.createElement("span",null,"Total ",this.props.sign," ",e):m.a.createElement("span",null,"Checkout empty")),e>0?m.a.createElement("div",{className:"col-12 d-flex justify-content-around"},m.a.createElement("button",{className:"btn btn-danger",onClick:this.props.reset},"Reset"),m.a.createElement("button",{className:"btn btn-primary btn-lg",onClick:this.props.done},"Done")):null))}}]),e}(m.a.Component),y=function(t){function e(){return Object(r.a)(this,e),Object(c.a)(this,Object(i.a)(e).apply(this,arguments))}return Object(l.a)(e,t),Object(s.a)(e,[{key:"componentWillMount",value:function(){document.title="Register"}},{key:"render",value:function(){var t=this;return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"row"},m.a.createElement(v,{cart:this.props.cart,sign:this.props.sign,reset:this.props.reset,done:this.props.done}),m.a.createElement("div",{className:"row productList mr-auto col-12 col-lg-10"},this.props.products.map(function(e,a){return e.enabled?m.a.createElement(g,{key:a,product:e,sign:t.props.sign,add:t.props.add,remove:t.props.remove}):null}))))}}]),e}(m.a.Component);function E(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function S(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),n.forEach(function(e){E(t,e,a[e])})}return t}var N=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(c.a)(this,Object(i.a)(e).call(this,t))).state=S({},t),a}return Object(l.a)(e,t),Object(s.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.setState(S({},t))}},{key:"componentDidMount",value:function(){document.title="Settings"}},{key:"render",value:function(){var t=this;return m.a.createElement(m.a.Fragment,null,m.a.createElement("form",{className:"form"},m.a.createElement("div",{className:"form-row"},m.a.createElement("div",{className:"form-group col"},m.a.createElement("label",{htmlFor:"name"},"Name:"),m.a.createElement("input",{type:"text",className:"form-control",name:"name",value:this.state.name,onChange:function(e){return t.setState({name:e.target.value})},placeholder:"Set or update the name for your application"}))),m.a.createElement("div",{className:"form-row"},m.a.createElement("div",{className:"form-group col"},m.a.createElement("label",{htmlFor:"increments"},"Round price to:"),m.a.createElement("input",{type:"number",className:"form-control",name:"increments",placeholder:this.state.increments,onChange:function(e){return t.setState({increments:e.target.value})},min:"0.01",max:"0.50",step:"0.01"})),m.a.createElement("div",{className:"form-group col"},m.a.createElement("label",{htmlFor:"round"},"Decimal places:"),m.a.createElement("select",{name:"round",className:"form-control",value:this.state.round,onChange:function(e){return t.setState({round:e.target.value})}},m.a.createElement("option",{value:"0"},"0"),m.a.createElement("option",{value:"1"},"0.1"),m.a.createElement("option",{value:"2"},"0.01"))),m.a.createElement("div",{className:"form-group col"},m.a.createElement("label",{htmlFor:"sign"},"Currency symbol"),m.a.createElement("select",{name:"sign",value:this.state.sign,onChange:function(e){return t.setState({sign:e.target.value})},className:"form-control"},m.a.createElement("option",{value:"\u20ac"},"\u20ac"),m.a.createElement("option",{value:"$"},"$"),m.a.createElement("option",{value:"\xa3"},"\xa3")))),m.a.createElement("hr",null),m.a.createElement("div",{className:"form-row"},m.a.createElement("div",{className:"form-group col"},m.a.createElement("label",{htmlFor:"refreshIntervalRange"},"Refresh interval in seconds ",m.a.createElement("small",{className:"text-muted"},"Setting 0 will mean that every time an order is pushed to the server it get's router directly to all clients")),m.a.createElement("div",null,this.state.refreshInterval),m.a.createElement("input",{className:"form-control-range",name:"refreshInterval",type:"range",min:"0",max:"300",value:this.state.refreshInterval,onChange:function(e){return t.setState({refreshInterval:e.target.value})}}))),m.a.createElement("hr",null),m.a.createElement("div",{className:"form-row justify-content-around"},m.a.createElement("button",{type:"button",className:"btn btn-success",onClick:function(){t.props.updateStatusBar("Saving configuration","bg-primary text-white",!1),t.props.updateSettings(t.state)}},"Save"),m.a.createElement("button",{type:"button",className:"btn btn-warning",disabled:!this.state.configSaved,onClick:function(){window.confirm("Applying settings will restart the server, this will reset the application, timers and remove any unsaved or in progress transactions since last update\nAre you sure?")&&t.props.restartServer()}},"Apply settings"))))}}]),e}(m.a.Component),w=(a(43),a(44)),P=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(c.a)(this,Object(i.a)(e).call(this,t))).state=S({editing:!1},t.specs),a.changeEnable=a.changeEnable.bind(Object(o.a)(a)),a.processUpdate=a.processUpdate.bind(Object(o.a)(a)),a.updateProduct=a.updateProduct.bind(Object(o.a)(a)),a.removeProduct=a.removeProduct.bind(Object(o.a)(a)),a}return Object(l.a)(e,t),Object(s.a)(e,[{key:"changeEnable",value:function(){var t=this;this.setState({enabled:!this.state.enabled},function(){t.updateProduct(t.props.specs.id,[{propName:"enabled",propValue:t.state.enabled}])})}},{key:"processUpdate",value:function(){var t=[];this.state.name!==this.state.tempName&&t.push({propName:"name",propValue:this.state.tempName}),this.state.minPrice!==this.state.tempMinPrice&&t.push({propName:"minPrice",propValue:this.state.tempMinPrice}),this.state.maxPrice!==this.state.tempMaxPrice&&t.push({propName:"maxPrice",propValue:this.state.tempMaxPrice}),this.state.currentPrice!==this.state.tempCurrentPrice&&t.push({propName:"currentPrice",propValue:this.state.tempCurrentPrice}),this.state.startPrice!==this.state.tempStartPrice&&t.push({propName:"startPrice",propValue:this.state.tempStartPrice}),this.updateProduct(this.props.specs.id,t)}},{key:"updateProduct",value:function(t,e){var a=this;this.props.update(t,e).then(function(t){t.success?a.props.updateStatusBar("Saved product update","bg-success text-light"):a.props.updateStatusBar("Failed to save update, ".concat(t.error),"bg-danger text-white",!1)}).catch(function(t){return console.error(t)})}},{key:"removeProduct",value:function(){var t=this;window.confirm("Deleting a product can not be reversed and the product will not be accessible anymore\nAre you sure you want to remove this product?\n\nIf you just don't want it to show up you can simply disable it")&&this.props.remove(this.props.specs.id).then(function(e){e.success?t.props.updateStatusBar("Removed product","bg-success text-light"):t.props.updateStatusBar("Failed to remove product, ".concat(e.error),"bg-danger text-white",!1)}).catch(function(t){return console.error(t)})}},{key:"render",value:function(){var t=this;return m.a.createElement("div",{className:"col col-sm-4 p-4"},m.a.createElement("div",{className:"product rounded ".concat(this.state.enabled||this.state.editing?null:"disabledProduct")},m.a.createElement("div",{className:"card"},m.a.createElement("div",{className:"card-header"},m.a.createElement("h5",{className:"card-title"},this.state.editing?m.a.createElement("input",{className:"form-control-sm d-inline",type:"text",onChange:function(e){t.setState({tempName:e.target.value})},value:this.state.tempName}):this.state.name),m.a.createElement("h6",{className:"card-subtitle text-muted mb-2"},"Stock: ",m.a.createElement("span",{className:"text-primary"},this.state.currentStock)," / ",this.state.stock)),m.a.createElement("div",{className:"card-body"},m.a.createElement("div",{className:"card-text"},m.a.createElement("ul",{className:"list-group list-group-flush"},m.a.createElement("li",{className:"list-group-item"},"Min price: ",this.props.sign," ",this.state.editing?m.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(e){t.setState({tempMinPrice:e.target.value})},value:this.state.tempMinPrice}):this.state.minPrice),m.a.createElement("li",{className:"list-group-item"},"Max price: ",this.props.sign," ",this.state.editing?m.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(e){t.setState({tempMaxPrice:e.target.value})},value:this.state.tempMaxPrice}):this.state.maxPrice),m.a.createElement("li",{className:"list-group-item"},"Start price: ",this.props.sign," ",this.state.editing?m.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(e){t.setState({tempStartPrice:e.target.value})},value:this.state.tempStartPrice}):this.state.startPrice),m.a.createElement("li",{className:"list-group-item text-primary"},"Current price: ",this.props.sign," ",this.state.editing?m.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(e){t.setState({tempCurrentPrice:e.target.value})},value:this.state.tempCurrentPrice}):this.state.currentPrice),this.state.editing?m.a.createElement("li",{className:"list-group-item"},m.a.createElement("button",{className:"btn ".concat(this.state.name===this.state.tempName&&this.state.minPrice===this.state.tempMinPrice&&this.state.maxPrice===this.state.tempMaxPrice&&this.state.startPrice===this.state.tempStartPrice&&this.state.currentPrice===this.state.tempCurrentPrice?"btn-warning":"btn-success"),disabled:this.state.name===this.state.tempName&&this.state.minPrice===this.state.tempMinPrice&&this.state.maxPrice===this.state.tempMaxPrice&&this.state.startPrice===this.state.tempStartPrice&&this.state.currentPrice===this.state.tempCurrentPrice,onClick:this.processUpdate},"Save changes")):null))),m.a.createElement("div",{className:"card-footer d-flex justify-content-around"},m.a.createElement("button",{className:"btn ".concat(this.state.editing?"btn-outline-primary":null),onClick:function(){t.setState({editing:!t.state.editing,tempName:t.state.name,tempMinPrice:t.state.minPrice,tempMaxPrice:t.state.maxPrice,tempStartPrice:t.state.startPrice,tempCurrentPrice:t.state.currentPrice})}},"Edit"),m.a.createElement("button",{className:"btn btn-sm btn-danger",onClick:this.removeProduct,disabled:this.state.editing},"Delete"),m.a.createElement("div",{className:"custom-control custom-switch"},m.a.createElement("input",{type:"checkbox",disabled:this.state.editing,className:"custom-control-input",value:this.state.enabled,checked:Boolean(this.state.enabled),id:"customSwitch".concat(this.state.id),onChange:this.changeEnable}),m.a.createElement("label",{className:"custom-control-label",htmlFor:"customSwitch".concat(this.state.id)},this.state.enabled?"Enabled":"Disabled"))))))}}]),e}(m.a.Component),O=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(c.a)(this,Object(i.a)(e).call(this,t))).state={overlay:!0},a.handleLeave=a.handleLeave.bind(Object(o.a)(a)),a.formSubmit=a.formSubmit.bind(Object(o.a)(a)),a}return Object(l.a)(e,t),Object(s.a)(e,[{key:"handleLeave",value:function(){this.state.overlay||0===Array.from(document.querySelectorAll(".product.add form input")).filter(function(t){return!!t.value}).length&&this.setState({overlay:!0,complete:!1})}},{key:"formSubmit",value:function(t){var e=this;t.preventDefault();var a=document.querySelector(".product.add form"),n=new FormData(a);if(Array.from(n.values()).filter(function(t){return!!t}).length!==Array.from(n.keys()).length)window.alert("All fields are required");else{this.props.updateStatusBar("Send new product to server..","bg-warning text-light",!1),n.append("enabled",!1),n.append("currentPrice",n.get("startPrice")),n.append("currentStock",n.get("stock")),n.append("id",w());var r={},s=!0,c=!1,i=void 0;try{for(var o,l=n.entries()[Symbol.iterator]();!(s=(o=l.next()).done);s=!0){var u=o.value;r[u[0]]=u[1]}}catch(m){c=!0,i=m}finally{try{s||null==l.return||l.return()}finally{if(c)throw i}}this.props.new(r).then(function(t){t.success?(e.props.updateStatusBar("New product saved","bg-success text-light"),a.reset(),a.blur()):(e.props.updateStatusBar("Failed to save new product, ".concat(t.error),"bg-danger text-light",!1),a.focus())}).catch(function(t){return e.props.updateStatusBar("Something went wrong :'(, ".concat(t),"bg-danger text-light",!1)})}}},{key:"componentWillMount",value:function(){document.title="Products"}},{key:"render",value:function(){var t=this;return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{className:"row d-flex"},this.props.products.map(function(e,a){return m.a.createElement(P,{key:a,specs:e,sign:t.props.sign,update:t.props.update,remove:t.props.remove,updateStatusBar:t.props.updateStatusBar})}),m.a.createElement("div",{className:"col col-sm-4 p-4"},m.a.createElement("div",{className:"product rounded add",onMouseLeave:this.handleLeave},this.state.overlay?m.a.createElement("div",{className:"overlay rounded d-flex justify-content-center align-items-center",onClick:function(){t.setState({overlay:!1})}},"+"):null,m.a.createElement("div",{className:"card"},m.a.createElement("form",{className:"rounded",name:"newProduct",method:"POST",action:"http://localhost:3001/products",onSubmit:this.formSubmit},m.a.createElement("div",{className:"card-img-top"}),m.a.createElement("div",{className:"card-header"},m.a.createElement("h5",{className:"card-title"},m.a.createElement("input",{name:"name",type:"text",placeholder:"Name",className:"form-control-sm",required:"required"})),m.a.createElement("h6",{className:"card-subtitle text-muted mb-2"},m.a.createElement("input",{name:"stock",type:"number",min:"1",placeholder:"Stock",step:"1",className:"form-control-sm d-inline",required:"required"}))),m.a.createElement("div",{className:"card-body"},m.a.createElement("div",{className:"card-text"},m.a.createElement("ul",{className:"list-group list-group-flush"},m.a.createElement("li",{className:"list-group-item"},this.props.sign,m.a.createElement("input",{name:"minPrice",min:"0",step:"0.01",placeholder:"Minimum Price",type:"number",className:"form-control-sm d-inline",required:"required"})),m.a.createElement("li",{className:"list-group-item"},this.props.sign,m.a.createElement("input",{name:"maxPrice",type:"number",min:"0",step:"0.01",placeholder:"Maximum Price",className:"form-control-sm d-inline",required:"required"})),m.a.createElement("li",{className:"list-group-item"},this.props.sign,m.a.createElement("input",{name:"startPrice",type:"number",min:"0",step:"0.01",placeholder:"Starting Price",className:"form-control-sm d-inline",required:"required"}))))),m.a.createElement("div",{className:"card-footer d-flex justify-content-around"},m.a.createElement("button",{type:"submit",className:"btn btn-primary",style:{order:1}},"Done"),m.a.createElement("button",{type:"reset",className:"btn btn-secondary",style:{order:0}},"Reset"))))))))}}]),e}(m.a.Component),j=(a(18),{display:"flex",justifyContent:"center",alignItems:"center",height:window.innerHeight+"px",width:"100%",position:"absolute",top:0,left:0}),k={height:"100px",width:"100px",border:"16px #f5b042 solid",borderTop:"16px rgba(0,0,0,0) solid",borderRadius:"50%",animationName:"rotation",animationDuration:"2s",animationIterationCount:"infinite",animationTimingFunction:"linear"},x={display:"flex",flexDirection:"column",alignItems:"center"},C=function(t){return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{style:j},m.a.createElement("div",{style:x},m.a.createElement("div",{style:k}),m.a.createElement("div",{className:"mt-2"},t.waitingFor))))},F={position:"fixed",left:0,bottom:0,width:"100%",textAlign:"center",zIndex:1e3},M=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(c.a)(this,Object(i.a)(e).call(this,t))).state={content:a.props.content},a}return Object(l.a)(e,t),Object(s.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.setState({content:t.content})}},{key:"render",value:function(){return m.a.createElement(m.a.Fragment,null,m.a.createElement("footer",{style:F,className:"p-2 mt-2 ".concat(this.props.pClass)},this.state.content))}}]),e}(m.a.Component);a.d(e,"default",function(){return q});var q=function(t){function e(t){var a;return Object(r.a)(this,e),(a=Object(c.a)(this,Object(i.a)(e).call(this,t))).state={settings:{},products:[],cart:[],loading:"",statusbar:null,configSaved:!1,isMaster:!1,connected:!1},a.URL=null,a.ws=null,localStorage.setItem("app_id",null),a.updateStatus=a.updateStatus.bind(Object(o.a)(a)),a.updateSettings=a.updateSettings.bind(Object(o.a)(a)),a.updateProduct=a.updateProduct.bind(Object(o.a)(a)),a.newProduct=a.newProduct.bind(Object(o.a)(a)),a.removeProduct=a.removeProduct.bind(Object(o.a)(a)),a.restartServer=a.restartServer.bind(Object(o.a)(a)),a.addToCart=a.addToCart.bind(Object(o.a)(a)),a.removeFromCart=a.removeFromCart.bind(Object(o.a)(a)),a.emptyCart=a.emptyCart.bind(Object(o.a)(a)),a.checkoutCart=a.checkoutCart.bind(Object(o.a)(a)),a.connect=a.connect.bind(Object(o.a)(a)),a.forceUpdate=a.forceUpdate.bind(Object(o.a)(a)),a}return Object(l.a)(e,t),Object(s.a)(e,[{key:"connect",value:function(t){var e=this;this.ws=new WebSocket(t),this.ws.addEventListener("open",function(t){1===e.ws.readyState?(e.ws.send(JSON.stringify({type:"connect",data:localStorage.getItem("app_id")})),e.updateStatus("Connected to server","bg-success text-light"),e.setState({connected:!0})):e.setState({connected:!1})}),this.ws.addEventListener("message",function(t){switch((t=JSON.parse(t.data)).type){case"master":t.data&&(e.setState({isMaster:!0}),localStorage.setItem("app_id",t.data));break;case"update":e.setState({products:t.data});break;case"updateConfig":e.setState({settings:t.data,configSaved:!1});break;case"updateStock":e.setState({products:e.state.products.map(function(e){var a=t.data.findIndex(function(t){return t.for===e.id});return-1!==a&&(e.currentStock=t.data[a].stock),e})},function(){e.updateStatus("Stock updated","bg-success text-white")});break;case"checkoutComplete":e.setState({cart:[]},function(){e.emptyCart()});break;case"updateProduct":e.setState(function(e){return{products:e.products.map(function(e){return e.id===t.data.id&&t.data.props.forEach(function(t){e[t.propName]=t.propValue}),e})}},function(){e.updateStatus("Product updated","bg-success text-white")});break;case"newProduct":e.setState(function(e){return{products:[].concat(n(e.products),[t.data])}},function(){e.updateStatus("New product added","bg-success text-white")});break;case"removeProduct":e.setState(function(e){return{products:e.products.filter(function(e){return e.id!==t.data})}},function(){e.updateStatus("".concat(t.data," removed"),"bg-warning text-white")})}}),this.ws.addEventListener("error",function(){e.ws.close()}),this.ws.addEventListener("close",function(){e.setState({connected:!1}),e.updateStatus("Disconnected :'( Hold on! Trying to reconnect...","bg-danger text-white",!1),setTimeout(function(){e.connect(t)},500)})}},{key:"addToCart",value:function(t,e){var a=this.state.products.find(function(e){return e.id===t});if(e<=a.currentStock&&a.enabled){var r=this.state.cart.findIndex(function(e){return e.id===t});-1===r?this.setState({cart:[].concat(n(this.state.cart),[{id:t,quantity:e,readableName:a.name,currentPrice:a.currentPrice}])}):this.setState({cart:n(this.state.cart.map(function(t,n){return r!==n?t:(t.quantity+e<=a.currentStock&&(t.quantity+=e),t)}))})}}},{key:"forceUpdate",value:function(){this.ws.send(JSON.stringify({type:"forceUpdate"}))}},{key:"removeFromCart",value:function(t,e){this.setState({cart:n(this.state.cart.map(function(a){return a.id===t?a.quantity-e>=0?(a.quantity-=e,a):(a.quantity=0,a):a}))})}},{key:"emptyCart",value:function(){this.setState({cart:[]})}},{key:"checkoutCart",value:function(){this.ws.send(JSON.stringify({type:"checkout",data:this.state.cart}))}},{key:"updateStatus",value:function(t,e){var a=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setState({statusbar:{content:t,pClass:e}}),n&&setTimeout(function(){a.setState({statusbar:null})},3e3)}},{key:"updateSettings",value:function(t){var e=this;this.setState({settings:t},function(){e.saveSettings().then(function(t,a){a?e.updateStatus("Server error","bg-warning text-white",!1):e.updateStatus.apply(e,n(t))})})}},{key:"saveSettings",value:function(){var t=this;return new Promise(function(e,a){fetch("http://localhost:3000/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),settings:t.state.settings})}).then(function(t){return t.json()}).then(function(a){a.success?(t.setState({configSaved:!0}),e(["Saved configuration","bg-success text-white"])):e(["Failed to save configuration, ".concat(a.error),"bg-danger text-white",!1])}).catch(function(t){return a([t,"bg-warning text-light",!1])})})}},{key:"newProduct",value:function(t){return new Promise(function(e,a){fetch("http://localhost:3000/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),data:{type:"add",payload:t}})}).then(function(t){return t.json()}).then(function(t){return e(t)}).catch(function(t){return a(t)})})}},{key:"updateProduct",value:function(t,e){return new Promise(function(a,n){fetch("http://localhost:3000/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),data:{type:"update",payload:{id:t,props:e}}})}).then(function(t){return t.json()}).then(function(t){return a(t)}).catch(function(t){return n(t)})})}},{key:"removeProduct",value:function(t){return new Promise(function(e,a){fetch("http://localhost:3000/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),data:{type:"remove",payload:t}})}).then(function(t){return t.json()}).then(function(t){return e(t)}).catch(function(t){return a(t)})})}},{key:"restartServer",value:function(){fetch("http://localhost:3000/restartServer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id"))})})}},{key:"componentWillMount",value:function(){document.body.classList.add("container-fluid"),document.title="Beurscafe"}},{key:"componentDidMount",value:function(){var t=this;this.URL=new URL(window.location.href),this.setState({loading:"Loading Settings"}),fetch("http://localhost:3000/api/settings").then(function(t){return t.json()}).then(function(e){return t.setState({settings:e,loading:"Loading Products"}),fetch("http://localhost:3000/api/products")}).then(function(t){return t.json()}).then(function(e){return t.setState({products:e,loading:!1})}),this.connect("ws://localhost:3000/")}},{key:"render",value:function(){var t=this;return m.a.createElement(m.a.Fragment,null,m.a.createElement(p.a,null,m.a.createElement(h,{brand:this.state.settings.name,role:this.state.isMaster,connected:this.state.connected}),this.state.loading?m.a.createElement(C,{waitingFor:this.state.loading}):m.a.createElement(m.a.Fragment,null,m.a.createElement("button",{onClick:this.forceUpdate},"Force update"),m.a.createElement(d.b,{path:"/register",render:function(){return m.a.createElement(y,{products:t.state.products,cart:t.state.cart,sign:t.state.settings.sign,add:t.addToCart,remove:t.removeFromCart,reset:t.emptyCart,done:t.checkoutCart})}}),m.a.createElement(d.b,{path:"/products",render:function(){return m.a.createElement(O,{products:t.state.products,sign:t.state.settings.sign,updateStatusBar:t.updateStatus,update:t.updateProduct,remove:t.removeProduct,new:t.newProduct})}}),m.a.createElement(d.b,{path:"/settings",render:function(){return m.a.createElement(N,Object.assign({},t.state.settings,{configSaved:t.state.configSaved,restartServer:t.restartServer,updateStatusBar:t.updateStatus,updateSettings:t.updateSettings}))}}))),this.state.statusbar?m.a.createElement(M,{content:this.state.statusbar.content,pClass:this.state.statusbar.pClass}):null)}}]),e}(m.a.Component)},31:function(t,e,a){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}a.d(e,"a",function(){return n})},32:function(t,e,a){"use strict";function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}a.d(e,"a",function(){return r})},33:function(t,e,a){"use strict";function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}a.d(e,"a",function(){return n})},34:function(t,e,a){"use strict";function n(t){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){return(r="function"===typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return n(t)}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)})(t)}var s=a(36);function c(t,e){return!e||"object"!==r(e)&&"function"!==typeof e?Object(s.a)(t):e}a.d(e,"a",function(){return c})},35:function(t,e,a){"use strict";function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}a.d(e,"a",function(){return r})},36:function(t,e,a){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}a.d(e,"a",function(){return n})},42:function(t,e,a){},43:function(t,e,a){},44:function(t,e,a){var n,r,s=a(45),c=a(46),i=0,o=0;t.exports=function(t,e,a){var l=e&&a||0,u=e||[],m=(t=t||{}).node||n,p=void 0!==t.clockseq?t.clockseq:r;if(null==m||null==p){var d=s();null==m&&(m=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==p&&(p=r=16383&(d[6]<<8|d[7]))}var h=void 0!==t.msecs?t.msecs:(new Date).getTime(),f=void 0!==t.nsecs?t.nsecs:o+1,b=h-i+(f-o)/1e4;if(b<0&&void 0===t.clockseq&&(p=p+1&16383),(b<0||h>i)&&void 0===t.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");i=h,o=f,r=p;var g=(1e4*(268435455&(h+=122192928e5))+f)%4294967296;u[l++]=g>>>24&255,u[l++]=g>>>16&255,u[l++]=g>>>8&255,u[l++]=255&g;var v=h/4294967296*1e4&268435455;u[l++]=v>>>8&255,u[l++]=255&v,u[l++]=v>>>24&15|16,u[l++]=v>>>16&255,u[l++]=p>>>8|128,u[l++]=255&p;for(var y=0;y<6;++y)u[l+y]=m[y];return e||c(u)}},45:function(t,e){var a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(a){var n=new Uint8Array(16);t.exports=function(){return a(n),n}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0===(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},46:function(t,e){for(var a=[],n=0;n<256;++n)a[n]=(n+256).toString(16).substr(1);t.exports=function(t,e){var n=e||0,r=a;return[r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]]].join("")}}}]);
//# sourceMappingURL=3.c2e7b5ce.chunk.js.map