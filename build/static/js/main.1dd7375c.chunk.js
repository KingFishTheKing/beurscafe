(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(t,e,a){t.exports=a(37)},34:function(t,e,a){},35:function(t,e,a){},37:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),r=a(21),o=a.n(r),i=a(24),c=a(2),l=a(3),u=a(5),m=a(4),p=a(7),d=a(6),h=a(12),b=a(11),f=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(m.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("nav",{className:"navbar navbar-expand bg-light sticky-top mb-2 navbar-light"},s.a.createElement("div",{className:"navbar-brand"},this.props.name),s.a.createElement("ul",{className:"navbar-nav mr-auto"},s.a.createElement("li",{className:"nav-item"},s.a.createElement(h.b,{to:"/register",className:"nav-link"},"Register")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(h.b,{to:"/products",className:"nav-link"},"Products")),s.a.createElement("li",{className:"nav-item"},s.a.createElement(h.b,{to:"/settings",className:"nav-link"},"Settings"))),s.a.createElement("div",{className:"navbar-nav"},"Running as ",this.props.master?'<span className="text-red">Master</span>':'<span className="text-primary">Slave</span>')))}}]),e}(s.a.Component),g=(a(34),{maxWidth:"100px",maxHeight:"100px",width:"auto",height:"auto",objectFit:"contain"}),v=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(m.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{alt:"",src:this.props.source,style:g}))}}]),e}(s.a.Component),E=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state={amount:a.props.amount,currentPrice:a.props.currentPrice,stock:a.props.stock,hasUpdated:!0},a.plusOne=a.plusOne.bind(Object(p.a)(a)),a.minusOne=a.minusOne.bind(Object(p.a)(a)),a.setInput=a.props.setInput,a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentWillMount",value:function(){document.title="Register"}},{key:"minusOne",value:function(){0!==this.state.amount&&this.setState({amount:this.state.amount-1,stock:this.state.stock+1,hasUpdated:!1})}},{key:"plusOne",value:function(){this.state.amount<this.state.stock&&this.setState({amount:this.state.amount+1,stock:this.state.stock-1,hasUpdated:!1})}},{key:"componentDidUpdate",value:function(){this.state.hasUpdated||(this.setInput(this.props.productId,this.state.amount),this.setState({hasUpdated:!0}))}},{key:"componentWillReceiveProps",value:function(t){this.setState({amount:t.amount,currentPrice:t.currentPrice,stock:t.stock})}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"col-auto col-sm-6 col-md-4 col-lg-3 mb-2"},s.a.createElement("div",{className:"bg-light rounded p-3"},s.a.createElement("div",{className:"row mb-4 d-flex justify-content-between p-3"},s.a.createElement("b",null,this.props.name),"\u20ac ",this.state.currentPrice,s.a.createElement("small",{className:this.state.stock<30?"text-danger":"text-muted"},"(stock: ",this.state.stock,")")),s.a.createElement("div",{className:"row mb-4"},s.a.createElement("div",{className:"col-12 d-flex justify-content-center"},this.props.display?s.a.createElement(v,{className:"col-12",source:"".concat("","/image/").concat(this.props.display)}):null)),s.a.createElement("div",{className:"row mb-2"},s.a.createElement("div",{className:"col-6"},s.a.createElement("p",{className:"buttons minus rounded",onClick:this.minusOne},"-")),s.a.createElement("div",{className:"col-6"},s.a.createElement("p",{className:"buttons plus rounded",onClick:this.plusOne},"+"))))))}}]),e}(s.a.Component),y=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state={total:t.total,products:t.products},a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.setState({total:t.total,products:t.products})}},{key:"render",value:function(){var t=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"col-12 col-lg-2 row ml-auto mr-auto mb-2 align-items-start"},s.a.createElement("ul",{style:{width:"100%"},className:"list-group list-group-flush col-12"},Object.entries(this.state.total).map(function(e){return s.a.createElement("li",{key:e[0],className:"list-group-item d-flex justify-content-between align-items-start"},t.state.products[e[0]].name," ",s.a.createElement("small",{className:"text-muted ml-2"},"(\u20ac",t.state.products[e[0]].currentPrice,")"),s.a.createElement("span",{className:"badge badge-primary badge-pill ml-auto"},e[1]))})),s.a.createElement("p",{className:"mt-3 col-12 h3 d-flex justify-content-around text-primary"},s.a.createElement("span",null,"Total \u20ac",Math.round(100*Object.entries(this.state.total).map(function(e){return t.state.products[e[0]].currentPrice*[e[1]]}).reduce(function(t,e){return t+e},0))/100)),s.a.createElement("div",{className:"col-12 d-flex justify-content-around"},s.a.createElement("button",{className:"btn btn-danger",onClick:this.props.reset},"Reset"),s.a.createElement("button",{className:"btn btn-primary btn-lg",onClick:this.props.done},"Done"))))}}]),e}(s.a.Component),S=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state={total:Array(Object.entries(a.props.products).length).fill(0)},a.done=a.done.bind(Object(p.a)(a)),a.reset=a.reset.bind(Object(p.a)(a)),a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"setInput",value:function(t,e){this.setState(function(a){return{total:a.total.map(function(a,n){return n===Number(t)?e:a})}})}},{key:"reset",value:function(){this.setState({total:Array(Object.entries(this.props.products).length).fill(0)})}},{key:"done",value:function(){var t=this,e=this.state.total.map(function(e,a){return{id:a,db_id:t.props.products[a]._id,quantity:e,readAbleName:t.props.products[a].name,currentPrice:t.props.products[a].currentPrice,currentStock:t.props.products[a].stock-e}}).filter(function(t){return 0!==t.quantity});e={type:"updatePrices",data:e},this.props.ws.send(JSON.stringify(e)),this.reset(),this.props.updateStatus("Sending updates to server...","bg-warning text-white",!1)}},{key:"getUpdate",value:function(){this.props.ws.send(JSON.stringify({type:"getUpdate"}))}},{key:"componentWillMount",value:function(){}},{key:"render",value:function(){var t=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"row"},s.a.createElement("button",{onClick:this.getUpdate.bind(this)},"Update"),s.a.createElement(y,{products:this.props.products,total:this.state.total,reset:this.reset,done:this.done}),s.a.createElement("div",{className:"row productList mr-auto col-12 col-lg-10"},Object.entries(this.props.products).map(function(e,a){return s.a.createElement(E,Object.assign({key:a,productId:e[0]},e[1],{amount:t.state.total[e[0]]||0,id:t.props.id,setInput:t.setInput.bind(t)}))}))))}}]),e}(s.a.Component),O=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state={name:t.name||"",increments:t.increments||.05,round:t.round||.05,sign:t.sign||"\u20ac",refreshInterval:t.refreshInterval||180},a.updateState=a.updateState.bind(Object(p.a)(a)),a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"updateState",value:function(t){var e={};e[t.target.name]=t.target.value,this.setState(e),this.props.updateConfigState(!1)}},{key:"render",value:function(){var t=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("form",{className:"form"},s.a.createElement("div",{className:"form-row"},s.a.createElement("div",{className:"form-group col"},s.a.createElement("label",{htmlFor:"name"},"Name:"),s.a.createElement("input",{type:"text",className:"form-control",name:"name",value:this.state.name,onChange:this.updateState,placeholder:"Set or update the name for your application"}))),s.a.createElement("div",{className:"form-row"},s.a.createElement("div",{className:"form-group col"},s.a.createElement("label",{htmlFor:"increments"},"Increment/decrease price by:"),s.a.createElement("input",{type:"number",className:"form-control",name:"increments",placeholder:this.state.increments,onChange:this.updateState,min:"0.05",max:"0.50",step:"0.05"})),s.a.createElement("div",{className:"form-group col"},s.a.createElement("label",{htmlFor:"round"},"Round price to nearest:"),s.a.createElement("select",{name:"round",className:"form-control",value:this.state.round,onChange:this.updateState},s.a.createElement("option",{value:"0"},"0"),s.a.createElement("option",{value:"0.01"},"0.01"),s.a.createElement("option",{value:"0.05"},"0.05"),s.a.createElement("option",{value:"0.1"},"0.1"),s.a.createElement("option",{value:"0.2"},"0.2"),s.a.createElement("option",{value:"0.5"},"0.5"))),s.a.createElement("div",{className:"form-group col"},s.a.createElement("label",{htmlFor:"sign"},"Currency symbol"),s.a.createElement("select",{name:"sign",value:this.state.sign,onChange:this.updateState,className:"form-control"},s.a.createElement("option",{value:"\u20ac"},"\u20ac"),s.a.createElement("option",{value:"$"},"$"),s.a.createElement("option",{value:"\xa3"},"\xa3")))),s.a.createElement("hr",null),s.a.createElement("div",{className:"form-row"},s.a.createElement("div",{className:"form-group col"},s.a.createElement("label",{htmlFor:"refreshIntervalRange"},"Refresh interval in seconds ",s.a.createElement("small",{className:"text-muted"},"Setting 0 will mean that every time an order is pushed to the server it get's router directly to all clients")),s.a.createElement("div",null,this.state.refreshInterval),s.a.createElement("input",{className:"form-control-range",name:"refreshInterval",type:"range",min:"0",max:"300",value:this.state.refreshInterval,onChange:this.updateState}))),s.a.createElement("hr",null),s.a.createElement("div",{className:"form-row justify-content-around"},s.a.createElement("button",{type:"button",className:"btn btn-success",onClick:function(){t.props.updateStatusBar("Saving configuration","bg-primary text-white",!1),t.props.updateSettings(t.state)}},"Save"),s.a.createElement("button",{type:"button",className:"btn btn-warning",disabled:!this.props.savedConfig,onClick:function(){window.confirm("Applying settings will restart the server, this will reset the application, timers and remove any unsaved or in progress transactions since last update\n Are you sure?")&&console.log("do it!")}},"Apply settings"))))}}]),e}(s.a.Component),j=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state=t,a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return s.a.createElement("h1",null,"Products")}}]),e}(s.a.Component),N=(a(35),{display:"flex",justifyContent:"center",alignItems:"center",height:window.innerHeight+"px",width:"100%",position:"absolute",top:0,left:0}),k={height:"100px",width:"100px",border:"16px #f5b042 solid",borderTop:"16px rgba(0,0,0,0) solid",borderRadius:"50%",animationName:"rotation",animationDuration:"2s",animationIterationCount:"infinite",animationTimingFunction:"linear"},w={display:"flex",flexDirection:"column",alignItems:"center"},x=function(t){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:N},s.a.createElement("div",{style:w},s.a.createElement("div",{style:k}),s.a.createElement("div",{className:"mt-2"},t.waitingFor))))},C={position:"fixed",left:0,bottom:0,width:"100%",textAlign:"center"},I=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state={content:a.props.content},a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.setState({content:t.content})}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("footer",{style:C,className:"p-2 mt-2 ".concat(this.props.pClass)},this.state.content))}}]),e}(s.a.Component),P=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(m.a)(e).call(this,t))).state={settings:{id:Object({NODE_ENV:"production",PUBLIC_URL:""}).APP_ID,name:"default",increments:.05,round:.05,sign:"\u20ac",refreshInterval:180},products:{},loading:"",statusbar:null,savedConfig:!1,master:!1},a.URL=null,a.ws=null,localStorage.setItem("app_id",null),a.updateStatus=a.updateStatus.bind(Object(p.a)(a)),a.updateSettings=a.updateSettings.bind(Object(p.a)(a)),a.configEnableDisable=a.configEnableDisable.bind(Object(p.a)(a)),a.restartServer=a.restartServer.bind(Object(p.a)(a)),a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"connect",value:function(t){var e=this;this.ws=new WebSocket(t),this.ws.onopen=function(t){e.updateStatus("Connected to server","bg-success text-light")},this.ws.addEventListener("message",function(t){switch((t=JSON.parse(t.data)).type){case"masterID":localStorage.setItem("app_id",t.data);break;case"master":e.setState({isMaster:t.data});break;case"updateStock":e.setState(function(e){return{products:t.data}}),e.updateStatus("Stock updated","bg-success text-white")}}),this.ws.addEventListener("close",function(){e.updateStatus("Disconnected :'( Hold on! Trying to reconnect...","bg-danger text-white",!1),setTimeout(function(){e.connect(t)},2e3)}),this.ws.onerror=function(){e.updateStatus("Disconnected :'( Hold on! Trying to reconnect...","bg-danger text-white",!1),setTimeout(function(){e.connect(t)},2e3)}}},{key:"updateStatus",value:function(t,e){var a=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setState({statusbar:{content:t,pClass:e}}),n&&setTimeout(function(){a.setState({statusbar:null})},3e3)}},{key:"updateSettings",value:function(t){var e=this;this.setState({settings:t},function(){e.saveSettings().then(function(t,a){a?e.updateStatus("Server error","bg-warning text-white",!1):e.updateStatus.apply(e,Object(i.a)(t))})})}},{key:"saveSettings",value:function(){var t=this;return new Promise(function(e,a){fetch("http://localhost:3000/settings",{method:"POST",headers:{"Content-Type":"application/json","x-app_id":localStorage.getItem("app_id")},body:JSON.stringify(t.state.settings)}).then(function(t){return t.json()}).then(function(n){(n=JSON.parse(n)).success?(t.setState({savedConfig:!0}),e(["Saved configuration","bg-success text-white"])):a(["Failed to save configuration, ".concat(n.error),"bg-warning text-white",!1])}).catch(function(t){return a([t,"bg-warning text-light",!1])})})}},{key:"configEnableDisable",value:function(t){this.setState({savedConfig:t})}},{key:"restartServer",value:function(){fetch("http://localhost:3000/restartServer",{method:"POST",headers:{"Content-Type":"application/json","x-app_id":localStorage.getItem("app_id")},body:JSON.stringify(!0)})}},{key:"componentWillMount",value:function(){document.body.classList.add("container-fluid"),document.title="Beurscafe"}},{key:"componentDidMount",value:function(){var t=this;this.URL=new URL(window.location.href),this.setState({loading:"Loading Settings"}),fetch("http://localhost:3000/api/settings").then(function(t){return t.json()}).then(function(e){return t.setState({settings:e,loading:"Loading Products"}),fetch("http://localhost:3000/api/products")}).then(function(t){return t.json()}).then(function(e){return t.setState({products:e,loading:!1})}),this.connect("ws://localhost:3000/")}},{key:"componentWillUnmount",value:function(){this.viewer.close()}},{key:"render",value:function(){var t=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement(h.a,null,s.a.createElement(f,{role:this.state.master}),this.state.loading?s.a.createElement(x,{waitingFor:this.state.loading}):s.a.createElement(s.a.Fragment,null,s.a.createElement(b.a,{from:"/",to:"/register"}),s.a.createElement(b.b,{path:"/register",render:function(){return s.a.createElement(S,{ws:t.ws,updateStatus:t.updateStatus,id:t.state.settings.id,products:t.state.products})}}),s.a.createElement(b.b,{path:"/products",component:j}),s.a.createElement(b.b,{path:"/settings",render:function(){return s.a.createElement(O,Object.assign({},t.state.settings,{savedConfig:t.state.savedConfig,restartServer:t.restartServer,updateConfigState:t.configEnableDisable,updateStatusBar:t.updateStatus,updateSettings:t.updateSettings}))}}))),this.state.statusbar?s.a.createElement(I,{content:this.state.statusbar.content,pClass:this.state.statusbar.pClass}):null)}}]),e}(s.a.Component);a(36);o.a.render(s.a.createElement(P,null),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.1dd7375c.chunk.js.map