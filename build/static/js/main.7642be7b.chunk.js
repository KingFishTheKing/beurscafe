(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,a){e.exports=a(42)},35:function(e,t,a){},36:function(e,t,a){},40:function(e,t,a){},42:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(23),c=a.n(s),i=a(14),o=a(3),l=a(4),u=a(6),m=a(5),d=a(1),p=a(7),h=a(12),f=a(11),b=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"navbar navbar-expand bg-light sticky-top mb-2 navbar-light"},r.a.createElement("div",{className:"navbar-brand"},this.props.brand),r.a.createElement("ul",{className:"navbar-nav mr-auto"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.b,{to:"/register",className:"nav-link"},"Register")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.b,{to:"/products",className:"nav-link"},"Products")),r.a.createElement("li",{className:"nav-item"},r.a.createElement(h.b,{to:"/settings",className:"nav-link"},"Settings"))),r.a.createElement("div",{className:"navbar-nav f-flex flex-column"},r.a.createElement("span",null,"Running as ",r.a.createElement("span",{className:"font-weight-bold"},this.props.role?"Master":"Slave")),r.a.createElement("span",{className:"text-secondary font-weight-light"},"Status: ",this.props.connected?r.a.createElement("span",{className:"text-success"},"Connected"):r.a.createElement("span",{className:"text-danger"},"Disconnected")))))}}]),t}(r.a.Component),g=(a(35),{maxWidth:"100px",maxHeight:"100px",width:"auto",height:"auto",objectFit:"contain"}),v=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{alt:"",src:this.props.source,style:g}))}}]),t}(r.a.Component),y=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).plusOne=a.plusOne.bind(Object(d.a)(a)),a.minusOne=a.minusOne.bind(Object(d.a)(a)),a.setInput=a.props.setInput,a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"minusOne",value:function(){this.props.remove(this.props.product.id,1)}},{key:"plusOne",value:function(){this.props.add(this.props.product.id,1)}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,!0===this.props.product.enabled?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"col-auto col-sm-6 col-md-4 col-lg-3 mb-2"},r.a.createElement("div",{className:"bg-light rounded p-3"},r.a.createElement("div",{className:"row mb-4 d-flex justify-content-between p-3"},r.a.createElement("b",null,this.props.product.name),this.props.sign," ",this.props.product.currentPrice,r.a.createElement("small",{className:this.props.product.stock<30?"text-danger":"text-muted"},"(stock: ",this.props.product.currentStock,")")),r.a.createElement("div",{className:"row mb-4"},r.a.createElement("div",{className:"col-12 d-flex justify-content-center"},this.props.product.display?r.a.createElement(v,{className:"col-12",source:"".concat("","/image/").concat(this.props.product.display)}):null)),r.a.createElement("div",{className:"row mb-2"},r.a.createElement("div",{className:"col-6"},r.a.createElement("p",{className:"buttons minus rounded",onClick:this.minusOne},"-")),r.a.createElement("div",{className:"col-6"},r.a.createElement("p",{className:"buttons plus rounded",onClick:this.plusOne},"+")))))):null)}}]),t}(r.a.Component),E=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.cart.reduce(function(e,t){return e+t.quantity*t.currentPrice},0).toFixed(2);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"col-12 col-lg-2 row ml-auto mr-auto mb-2 align-items-start"},r.a.createElement("ul",{style:{width:"100%"},className:"list-group list-group-flush col-12"},this.props.cart.map(function(t,a){return t.quantity>0?r.a.createElement("li",{key:a,className:"list-group-item d-flex justify-content-between align-items-start"},t.readableName," ",r.a.createElement("small",{className:"text-muted ml-2"},"(",e.props.sign," ",t.currentPrice,")"),r.a.createElement("span",{className:"badge badge-primary badge-pill ml-auto"},t.quantity)):null})),r.a.createElement("p",{className:"mt-3 col-12 h3 d-flex justify-content-around text-primary"},t>0?r.a.createElement("span",null,"Total ",this.props.sign," ",t):r.a.createElement("span",null,"Checkout empty")),t>0?r.a.createElement("div",{className:"col-12 d-flex justify-content-around"},r.a.createElement("button",{className:"btn btn-danger",onClick:this.props.reset},"Reset"),r.a.createElement("button",{className:"btn btn-primary btn-lg",onClick:this.props.done},"Done")):null))}}]),t}(r.a.Component),S=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){document.title="Register"}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row"},r.a.createElement(E,{cart:this.props.cart,sign:this.props.sign,reset:this.props.reset,done:this.props.done}),r.a.createElement("div",{className:"row productList mr-auto col-12 col-lg-10"},this.props.products.map(function(t,a){return t.enabled?r.a.createElement(y,{key:a,product:t,sign:e.props.sign,add:e.props.add,remove:e.props.remove}):null}))))}}]),t}(r.a.Component),N=a(16),P=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state=Object(N.a)({},e),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(Object(N.a)({},e))}},{key:"componentDidMount",value:function(){document.title="Settings"}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("form",{className:"form"},r.a.createElement("div",{className:"form-row"},r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{htmlFor:"name"},"Name:"),r.a.createElement("input",{type:"text",className:"form-control",name:"name",value:this.state.name,onChange:function(t){return e.setState({name:t.target.value})},placeholder:"Set or update the name for your application"}))),r.a.createElement("div",{className:"form-row"},r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{htmlFor:"increments"},"Round price to:"),r.a.createElement("input",{type:"number",className:"form-control",name:"increments",placeholder:this.state.increments,onChange:function(t){return e.setState({increments:t.target.value})},min:"0.01",max:"0.50",step:"0.01"})),r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{htmlFor:"round"},"Decimal places:"),r.a.createElement("select",{name:"round",className:"form-control",value:this.state.round,onChange:function(t){return e.setState({round:t.target.value})}},r.a.createElement("option",{value:"0"},"0"),r.a.createElement("option",{value:"1"},"0.1"),r.a.createElement("option",{value:"2"},"0.01"))),r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{htmlFor:"sign"},"Currency symbol"),r.a.createElement("select",{name:"sign",value:this.state.sign,onChange:function(t){return e.setState({sign:t.target.value})},className:"form-control"},r.a.createElement("option",{value:"\u20ac"},"\u20ac"),r.a.createElement("option",{value:"$"},"$"),r.a.createElement("option",{value:"\xa3"},"\xa3")))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-row"},r.a.createElement("div",{className:"form-group col"},r.a.createElement("label",{htmlFor:"refreshIntervalRange"},"Refresh interval in seconds ",r.a.createElement("small",{className:"text-muted"},"Setting 0 will mean that every time an order is pushed to the server it get's router directly to all clients")),r.a.createElement("div",null,this.state.refreshInterval),r.a.createElement("input",{className:"form-control-range",name:"refreshInterval",type:"range",min:"0",max:"300",value:this.state.refreshInterval,onChange:function(t){return e.setState({refreshInterval:t.target.value})}}))),r.a.createElement("hr",null),r.a.createElement("div",{className:"form-row justify-content-around"},r.a.createElement("button",{type:"button",className:"btn btn-success",onClick:function(){e.props.updateStatusBar("Saving configuration","bg-primary text-white",!1),e.props.updateSettings(e.state)}},"Save"),r.a.createElement("button",{type:"button",className:"btn btn-warning",disabled:!this.state.configSaved,onClick:function(){window.confirm("Applying settings will restart the server, this will reset the application, timers and remove any unsaved or in progress transactions since last update\nAre you sure?")&&e.props.restartServer()}},"Apply settings"))))}}]),t}(r.a.Component),j=(a(36),a(37)),O=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state=Object(N.a)({editing:!1},e.specs),a.changeEnable=a.changeEnable.bind(Object(d.a)(a)),a.processUpdate=a.processUpdate.bind(Object(d.a)(a)),a.updateProduct=a.updateProduct.bind(Object(d.a)(a)),a.removeProduct=a.removeProduct.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"changeEnable",value:function(){var e=this;this.setState({enabled:!this.state.enabled},function(){e.updateProduct(e.props.specs.id,[{propName:"enabled",propValue:e.state.enabled}])})}},{key:"processUpdate",value:function(){var e=[];this.state.name!==this.state.tempName&&e.push({propName:"name",propValue:this.state.tempName}),this.state.minPrice!==this.state.tempMinPrice&&e.push({propName:"minPrice",propValue:this.state.tempMinPrice}),this.state.maxPrice!==this.state.tempMaxPrice&&e.push({propName:"maxPrice",propValue:this.state.tempMaxPrice}),this.state.currentPrice!==this.state.tempCurrentPrice&&e.push({propName:"currentPrice",propValue:this.state.tempCurrentPrice}),this.state.startPrice!==this.state.tempStartPrice&&e.push({propName:"startPrice",propValue:this.state.tempStartPrice}),this.updateProduct(this.props.specs.id,e)}},{key:"updateProduct",value:function(e,t){var a=this;this.props.update(e,t).then(function(e){e.success?a.props.updateStatusBar("Saved product update","bg-success text-light"):a.props.updateStatusBar("Failed to save update, ".concat(e.error),"bg-danger text-white",!1)}).catch(function(e){return console.error(e)})}},{key:"removeProduct",value:function(){var e=this;window.confirm("Deleting a product can not be reversed and the product will not be accessible anymore\nAre you sure you want to remove this product?\n\nIf you just don't want it to show up you can simply disable it")&&this.props.remove(this.props.specs.id).then(function(t){t.success?e.props.updateStatusBar("Removed product","bg-success text-light"):e.props.updateStatusBar("Failed to remove product, ".concat(t.error),"bg-danger text-white",!1)}).catch(function(e){return console.error(e)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"col col-sm-4 p-4"},r.a.createElement("div",{className:"product rounded ".concat(this.state.enabled||this.state.editing?null:"disabledProduct")},r.a.createElement("div",{className:"card"},r.a.createElement("div",{className:"card-header"},r.a.createElement("h5",{className:"card-title"},this.state.editing?r.a.createElement("input",{className:"form-control-sm d-inline",type:"text",onChange:function(t){e.setState({tempName:t.target.value})},value:this.state.tempName}):this.state.name),r.a.createElement("h6",{className:"card-subtitle text-muted mb-2"},"Stock: ",r.a.createElement("span",{className:"text-primary"},this.state.currentStock)," / ",this.state.stock)),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:"card-text"},r.a.createElement("ul",{className:"list-group list-group-flush"},r.a.createElement("li",{className:"list-group-item"},"Min price: ",this.props.sign," ",this.state.editing?r.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(t){e.setState({tempMinPrice:t.target.value})},value:this.state.tempMinPrice}):this.state.minPrice),r.a.createElement("li",{className:"list-group-item"},"Max price: ",this.props.sign," ",this.state.editing?r.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(t){e.setState({tempMaxPrice:t.target.value})},value:this.state.tempMaxPrice}):this.state.maxPrice),r.a.createElement("li",{className:"list-group-item"},"Start price: ",this.props.sign," ",this.state.editing?r.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(t){e.setState({tempStartPrice:t.target.value})},value:this.state.tempStartPrice}):this.state.startPrice),r.a.createElement("li",{className:"list-group-item text-primary"},"Current price: ",this.props.sign," ",this.state.editing?r.a.createElement("input",{min:"0",step:"0.01",type:"number",className:"form-control-sm d-inline",onChange:function(t){e.setState({tempCurrentPrice:t.target.value})},value:this.state.tempCurrentPrice}):this.state.currentPrice),this.state.editing?r.a.createElement("li",{className:"list-group-item"},r.a.createElement("button",{className:"btn ".concat(this.state.name===this.state.tempName&&this.state.minPrice===this.state.tempMinPrice&&this.state.maxPrice===this.state.tempMaxPrice&&this.state.startPrice===this.state.tempStartPrice&&this.state.currentPrice===this.state.tempCurrentPrice?"btn-warning":"btn-success"),disabled:this.state.name===this.state.tempName&&this.state.minPrice===this.state.tempMinPrice&&this.state.maxPrice===this.state.tempMaxPrice&&this.state.startPrice===this.state.tempStartPrice&&this.state.currentPrice===this.state.tempCurrentPrice,onClick:this.processUpdate},"Save changes")):null))),r.a.createElement("div",{className:"card-footer d-flex justify-content-around"},r.a.createElement("button",{className:"btn ".concat(this.state.editing?"btn-outline-primary":null),onClick:function(){e.setState({editing:!e.state.editing,tempName:e.state.name,tempMinPrice:e.state.minPrice,tempMaxPrice:e.state.maxPrice,tempStartPrice:e.state.startPrice,tempCurrentPrice:e.state.currentPrice})}},"Edit"),r.a.createElement("button",{className:"btn btn-sm btn-danger",onClick:this.removeProduct,disabled:this.state.editing},"Delete"),r.a.createElement("div",{className:"custom-control custom-switch"},r.a.createElement("input",{type:"checkbox",disabled:this.state.editing,className:"custom-control-input",value:this.state.enabled,checked:Boolean(this.state.enabled),id:"customSwitch".concat(this.state.id),onChange:this.changeEnable}),r.a.createElement("label",{className:"custom-control-label",htmlFor:"customSwitch".concat(this.state.id)},this.state.enabled?"Enabled":"Disabled"))))))}}]),t}(r.a.Component),w=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={overlay:!0},a.handleLeave=a.handleLeave.bind(Object(d.a)(a)),a.formSubmit=a.formSubmit.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleLeave",value:function(){this.state.overlay||0===Array.from(document.querySelectorAll(".product.add form input")).filter(function(e){return!!e.value}).length&&this.setState({overlay:!0,complete:!1})}},{key:"formSubmit",value:function(e){var t=this;e.preventDefault();var a=document.querySelector(".product.add form"),n=new FormData(a);if(Array.from(n.values()).filter(function(e){return!!e}).length!==Array.from(n.keys()).length)window.alert("All fields are required");else{this.props.updateStatusBar("Send new product to server..","bg-warning text-light",!1),n.append("enabled",!1),n.append("currentPrice",n.get("startPrice")),n.append("currentStock",n.get("stock")),n.append("id",j());var r={},s=!0,c=!1,i=void 0;try{for(var o,l=n.entries()[Symbol.iterator]();!(s=(o=l.next()).done);s=!0){var u=o.value;r[u[0]]=u[1]}}catch(m){c=!0,i=m}finally{try{s||null==l.return||l.return()}finally{if(c)throw i}}this.props.new(r).then(function(e){e.success?(t.props.updateStatusBar("New product saved","bg-success text-light"),a.reset(),a.blur()):(t.props.updateStatusBar("Failed to save new product, ".concat(e.error),"bg-danger text-light",!1),a.focus())}).catch(function(e){return t.props.updateStatusBar("Something went wrong :'(, ".concat(e),"bg-danger text-light",!1)})}}},{key:"componentWillMount",value:function(){document.title="Products"}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"row d-flex"},this.props.products.map(function(t,a){return r.a.createElement(O,{key:a,specs:t,sign:e.props.sign,update:e.props.update,remove:e.props.remove,updateStatusBar:e.props.updateStatusBar})}),r.a.createElement("div",{className:"col col-sm-4 p-4"},r.a.createElement("div",{className:"product rounded add",onMouseLeave:this.handleLeave},this.state.overlay?r.a.createElement("div",{className:"overlay rounded d-flex justify-content-center align-items-center",onClick:function(){e.setState({overlay:!1})}},"+"):null,r.a.createElement("div",{className:"card"},r.a.createElement("form",{className:"rounded",name:"newProduct",method:"POST",action:"http://localhost:3001/products",onSubmit:this.formSubmit},r.a.createElement("div",{className:"card-img-top"}),r.a.createElement("div",{className:"card-header"},r.a.createElement("h5",{className:"card-title"},r.a.createElement("input",{name:"name",type:"text",placeholder:"Name",className:"form-control-sm",required:"required"})),r.a.createElement("h6",{className:"card-subtitle text-muted mb-2"},r.a.createElement("input",{name:"stock",type:"number",min:"1",placeholder:"Stock",step:"1",className:"form-control-sm d-inline",required:"required"}))),r.a.createElement("div",{className:"card-body"},r.a.createElement("div",{className:"card-text"},r.a.createElement("ul",{className:"list-group list-group-flush"},r.a.createElement("li",{className:"list-group-item"},this.props.sign,r.a.createElement("input",{name:"minPrice",min:"0",step:"0.01",placeholder:"Minimum Price",type:"number",className:"form-control-sm d-inline",required:"required"})),r.a.createElement("li",{className:"list-group-item"},this.props.sign,r.a.createElement("input",{name:"maxPrice",type:"number",min:"0",step:"0.01",placeholder:"Maximum Price",className:"form-control-sm d-inline",required:"required"})),r.a.createElement("li",{className:"list-group-item"},this.props.sign,r.a.createElement("input",{name:"startPrice",type:"number",min:"0",step:"0.01",placeholder:"Starting Price",className:"form-control-sm d-inline",required:"required"}))))),r.a.createElement("div",{className:"card-footer d-flex justify-content-around"},r.a.createElement("button",{type:"submit",className:"btn btn-primary",style:{order:1}},"Done"),r.a.createElement("button",{type:"reset",className:"btn btn-secondary",style:{order:0}},"Reset"))))))))}}]),t}(r.a.Component),k=(a(40),{display:"flex",justifyContent:"center",alignItems:"center",height:window.innerHeight+"px",width:"100%",position:"absolute",top:0,left:0}),x={height:"100px",width:"100px",border:"16px #f5b042 solid",borderTop:"16px rgba(0,0,0,0) solid",borderRadius:"50%",animationName:"rotation",animationDuration:"2s",animationIterationCount:"infinite",animationTimingFunction:"linear"},C={display:"flex",flexDirection:"column",alignItems:"center"},F=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:k},r.a.createElement("div",{style:C},r.a.createElement("div",{style:x}),r.a.createElement("div",{className:"mt-2"},e.waitingFor))))},M={position:"fixed",left:0,bottom:0,width:"100%",textAlign:"center",zIndex:1e3},I=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={content:a.props.content},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({content:e.content})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("footer",{style:M,className:"p-2 mt-2 ".concat(this.props.pClass)},this.state.content))}}]),t}(r.a.Component),q=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={settings:{},products:[],cart:[],loading:"",statusbar:null,configSaved:!1,isMaster:!1,connected:!1},a.URL=null,a.ws=null,localStorage.setItem("app_id",null),a.updateStatus=a.updateStatus.bind(Object(d.a)(a)),a.updateSettings=a.updateSettings.bind(Object(d.a)(a)),a.updateProduct=a.updateProduct.bind(Object(d.a)(a)),a.newProduct=a.newProduct.bind(Object(d.a)(a)),a.removeProduct=a.removeProduct.bind(Object(d.a)(a)),a.restartServer=a.restartServer.bind(Object(d.a)(a)),a.addToCart=a.addToCart.bind(Object(d.a)(a)),a.removeFromCart=a.removeFromCart.bind(Object(d.a)(a)),a.emptyCart=a.emptyCart.bind(Object(d.a)(a)),a.checkoutCart=a.checkoutCart.bind(Object(d.a)(a)),a.connect=a.connect.bind(Object(d.a)(a)),a.forceUpdate=a.forceUpdate.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"connect",value:function(e){var t=this;this.ws=new WebSocket(e),this.ws.addEventListener("open",function(e){1===t.ws.readyState?(t.ws.send(JSON.stringify({type:"connect",data:localStorage.getItem("app_id")})),t.updateStatus("Connected to server","bg-success text-light"),t.setState({connected:!0})):t.setState({connected:!1})}),this.ws.addEventListener("message",function(e){switch((e=JSON.parse(e.data)).type){case"master":e.data&&(t.setState({isMaster:!0}),localStorage.setItem("app_id",e.data));break;case"update":t.setState({products:e.data});break;case"updateConfig":t.setState({settings:e.data,configSaved:!1});break;case"updateStock":t.setState({products:t.state.products.map(function(t){var a=e.data.findIndex(function(e){return e.for===t.id});return-1!==a&&(t.currentStock=e.data[a].stock),t})},function(){t.updateStatus("Stock updated","bg-success text-white")});break;case"checkoutComplete":t.setState({cart:[]},function(){t.emptyCart()});break;case"updateProduct":t.setState(function(t){return{products:t.products.map(function(t){return t.id===e.data.id&&e.data.props.forEach(function(e){t[e.propName]=e.propValue}),t})}},function(){t.updateStatus("Product updated","bg-success text-white")});break;case"newProduct":t.setState(function(t){return{products:[].concat(Object(i.a)(t.products),[e.data])}},function(){t.updateStatus("New product added","bg-success text-white")});break;case"removeProduct":t.setState(function(t){return{products:t.products.filter(function(t){return t.id!==e.data})}},function(){t.updateStatus("".concat(e.data," removed"),"bg-warning text-white")})}}),this.ws.addEventListener("error",function(){t.ws.close()}),this.ws.addEventListener("close",function(){t.setState({connected:!1}),t.updateStatus("Disconnected :'( Hold on! Trying to reconnect...","bg-danger text-white",!1),setTimeout(function(){t.connect(e)},500)})}},{key:"addToCart",value:function(e,t){var a=this.state.products.find(function(t){return t.id===e});if(t<=a.currentStock&&a.enabled){var n=this.state.cart.findIndex(function(t){return t.id===e});-1===n?this.setState({cart:[].concat(Object(i.a)(this.state.cart),[{id:e,quantity:t,readableName:a.name,currentPrice:a.currentPrice}])}):this.setState({cart:Object(i.a)(this.state.cart.map(function(e,r){return n!==r?e:(e.quantity+t<=a.currentStock&&(e.quantity+=t),e)}))})}}},{key:"forceUpdate",value:function(){this.ws.send(JSON.stringify({type:"forceUpdate"}))}},{key:"removeFromCart",value:function(e,t){this.setState({cart:Object(i.a)(this.state.cart.map(function(a){return a.id===e?a.quantity-t>=0?(a.quantity-=t,a):(a.quantity=0,a):a}))})}},{key:"emptyCart",value:function(){this.setState({cart:[]})}},{key:"checkoutCart",value:function(){this.ws.send(JSON.stringify({type:"checkout",data:this.state.cart}))}},{key:"updateStatus",value:function(e,t){var a=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setState({statusbar:{content:e,pClass:t}}),n&&setTimeout(function(){a.setState({statusbar:null})},3e3)}},{key:"updateSettings",value:function(e){var t=this;this.setState({settings:e},function(){t.saveSettings().then(function(e,a){a?t.updateStatus("Server error","bg-warning text-white",!1):t.updateStatus.apply(t,Object(i.a)(e))})})}},{key:"saveSettings",value:function(){var e=this;return new Promise(function(t,a){fetch("http://localhost:3000/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),settings:e.state.settings})}).then(function(e){return e.json()}).then(function(a){a.success?(e.setState({configSaved:!0}),t(["Saved configuration","bg-success text-white"])):t(["Failed to save configuration, ".concat(a.error),"bg-danger text-white",!1])}).catch(function(e){return a([e,"bg-warning text-light",!1])})})}},{key:"newProduct",value:function(e){return new Promise(function(t,a){fetch("http://localhost:3000/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),data:{type:"add",payload:e}})}).then(function(e){return e.json()}).then(function(e){return t(e)}).catch(function(e){return a(e)})})}},{key:"updateProduct",value:function(e,t){return new Promise(function(a,n){fetch("http://localhost:3000/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),data:{type:"update",payload:{id:e,props:t}}})}).then(function(e){return e.json()}).then(function(e){return a(e)}).catch(function(e){return n(e)})})}},{key:"removeProduct",value:function(e){return new Promise(function(t,a){fetch("http://localhost:3000/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id")),data:{type:"remove",payload:e}})}).then(function(e){return e.json()}).then(function(e){return t(e)}).catch(function(e){return a(e)})})}},{key:"restartServer",value:function(){fetch("http://localhost:3000/restartServer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({satisfy:btoa(localStorage.getItem("app_id"))})})}},{key:"componentWillMount",value:function(){document.body.classList.add("container-fluid"),document.title="Beurscafe"}},{key:"componentDidMount",value:function(){var e=this;this.URL=new URL(window.location.href),this.setState({loading:"Loading Settings"}),fetch("http://localhost:3000/api/settings").then(function(e){return e.json()}).then(function(t){return e.setState({settings:t,loading:"Loading Products"}),fetch("http://localhost:3000/api/products")}).then(function(e){return e.json()}).then(function(t){return e.setState({products:t,loading:!1})}),this.connect("ws://localhost:3000/")}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,null,r.a.createElement(b,{brand:this.state.settings.name,role:this.state.isMaster,connected:this.state.connected}),this.state.loading?r.a.createElement(F,{waitingFor:this.state.loading}):r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:this.forceUpdate},"Force update"),r.a.createElement(f.a,{path:"/register",render:function(){return r.a.createElement(S,{products:e.state.products,cart:e.state.cart,sign:e.state.settings.sign,add:e.addToCart,remove:e.removeFromCart,reset:e.emptyCart,done:e.checkoutCart})}}),r.a.createElement(f.a,{path:"/products",render:function(){return r.a.createElement(w,{products:e.state.products,sign:e.state.settings.sign,updateStatusBar:e.updateStatus,update:e.updateProduct,remove:e.removeProduct,new:e.newProduct})}}),r.a.createElement(f.a,{path:"/settings",render:function(){return r.a.createElement(P,Object.assign({},e.state.settings,{configSaved:e.state.configSaved,restartServer:e.restartServer,updateStatusBar:e.updateStatus,updateSettings:e.updateSettings}))}}))),this.state.statusbar?r.a.createElement(I,{content:this.state.statusbar.content,pClass:this.state.statusbar.pClass}):null)}}]),t}(r.a.Component);a(41);c.a.render(r.a.createElement(q,null),document.getElementById("root"))}},[[26,1,2]]]);
//# sourceMappingURL=main.7642be7b.chunk.js.map